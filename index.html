<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة كنوز | Global Strategic Assets</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet Map JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        
        .page-section { display: none; min-height: 100vh; padding-top: 5rem; animation: fadeIn 0.4s ease-out; }
        .page-section.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Input Styles */
        .input-field { width: 100%; padding: 1rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 1rem; font-weight: 700; outline: none; transition: all 0.3s; }
        .input-field:focus { border-color: #f59e0b; box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1); }
        .label { display: block; font-size: 0.75rem; font-weight: 900; color: #64748b; margin-bottom: 0.5rem; text-transform: uppercase; }
        
        /* Sidebar Transition */
        #notif-sidebar { transition: transform 0.3s ease-in-out; }
        #notif-sidebar.open { transform: translateX(0); }
        
        /* Map Styles */
        .custom-div-icon { background: transparent; border: none; }
        .leaflet-popup-content-wrapper { border-radius: 1rem; padding: 0.5rem; font-family: 'Cairo', sans-serif; }
        .leaflet-popup-tip { background: white; }
    </style>
</head>
<body class="text-slate-900">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-[1000] bg-white/95 backdrop-blur-xl border-b border-slate-200 px-6 py-3 flex justify-between items-center shadow-sm h-[70px]">
        <div class="flex items-center gap-3 cursor-pointer" onclick="navigateTo('landing')">
            <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center text-slate-950 font-black text-xl shadow-lg">ك</div>
            <div class="leading-none text-right">
                <span class="text-xl font-black text-slate-950 block italic">كنوز</span>
                <span class="text-[9px] text-slate-400 font-bold uppercase tracking-widest italic">Global Strategic Assets</span>
            </div>
        </div>
        
        <div class="hidden lg:flex items-center gap-6 text-[10px] font-black uppercase tracking-widest text-slate-500">
            <button onclick="navigateTo('landing')" class="hover:text-amber-500 transition-colors">الرئيسية</button>
            <button onclick="navigateTo('ent-dash')" class="hover:text-amber-500 transition-colors">لوحة الرائد</button>
            <button id="nav-inv" onclick="navigateTo('inv-dash')" class="hidden text-green-600">لوحة المستثمر</button>
            <button id="nav-admin" onclick="navigateTo('dashboard')" class="hidden text-blue-600">Strategy BI</button>
            <button id="nav-msgs" onclick="navigateTo('messages')" class="hidden text-slate-400">غرفة العمليات</button>
        </div>

        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar()" class="relative p-2 bg-slate-100 rounded-lg text-slate-600 hover:bg-amber-100 transition-colors">
                <i data-lucide="bell" class="w-5 h-5"></i>
                <span id="notif-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center border-2 border-white hidden">0</span>
            </button>
            <div class="bg-slate-100 p-1 rounded-full flex text-[9px] font-black border border-slate-200">
                <button onclick="setRole('user')" id="btn-user" class="px-4 py-1.5 rounded-full transition-all bg-white shadow-sm text-slate-900 font-bold">رائد</button>
                <button onclick="setRole('investor')" id="btn-investor" class="px-4 py-1.5 rounded-full transition-all text-slate-400">مستثمر</button>
                <button onclick="setRole('admin')" id="btn-admin" class="px-4 py-1.5 rounded-full transition-all text-slate-400">إدارة</button>
            </div>
        </div>
    </nav>

    <!-- Notification Sidebar -->
    <div id="notif-sidebar" class="fixed inset-y-0 right-0 w-96 bg-white shadow-2xl transform translate-x-full z-[2000] flex flex-col">
        <div class="p-6 border-b flex justify-between items-center bg-slate-50">
            <h3 class="font-black italic text-lg">سجل العمليات</h3>
            <button onclick="toggleSidebar()" class="hover:bg-slate-200 p-2 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div id="notif-list" class="p-6 overflow-y-auto grow space-y-4">
            <div class="text-center text-slate-400 text-xs mt-10 flex flex-col items-center gap-2">
                <i data-lucide="bell" class="opacity-20 w-10 h-10"></i>لا توجد إشعارات نشطة
            </div>
        </div>
        <div class="p-4 border-t bg-slate-50 text-center">
            <button onclick="clearNotifications()" class="text-red-500 text-xs font-bold hover:underline">مسح السجل بالكامل</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-24 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-2xl shadow-2xl z-[6000] flex items-center gap-4 transition-all duration-300 opacity-0 pointer-events-none translate-y-[-20px] min-w-[320px]">
        <i data-lucide="check-circle-2" class="text-amber-500 w-6 h-6"></i>
        <span id="toast-msg" class="font-bold text-sm"></span>
    </div>

    <!-- Main Content -->
    <main>
        
        <!-- 1. Landing Page -->
        <section id="landing" class="page-section active">
            <header class="pt-32 pb-24 px-6 bg-slate-950 text-white text-right relative overflow-hidden min-h-[85vh] flex items-center">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-amber-900/20 via-slate-950 to-slate-950"></div>
                <div class="container mx-auto relative z-10 max-w-6xl">
                    <span class="inline-block px-5 py-2 mb-8 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-500 text-[11px] font-black uppercase tracking-[0.2em]">Global Sovereign Assets</span>
                    <h1 class="text-5xl lg:text-8xl font-black italic leading-tight mb-8">
                        أصولك <span class="text-amber-500">استراتيجية</span><br />رقمية وعالمية
                    </h1>
                    <p class="text-slate-400 max-w-2xl text-xl font-light mb-12 leading-relaxed">
                        نظام كنوز يربط الأصول الضخمة بكبار المستثمرين السياديين عبر 16 قطاعاً استراتيجياً ومحرك Strategy BI المتطور.
                    </p>
                    <div class="flex gap-6">
                        <button onclick="navigateTo('registration')" class="bg-amber-500 text-slate-900 px-10 py-5 rounded-2xl font-black shadow-xl hover:scale-105 transition-all text-sm uppercase tracking-widest">بدء تسجيل مشروع</button>
                        <button onclick="setRole('admin')" class="bg-white/5 border border-white/10 px-10 py-5 rounded-2xl font-bold backdrop-blur-md text-sm hover:bg-white/10 transition-all">استكشاف المحرك الإداري</button>
                    </div>
                </div>
            </header>
            <div class="py-24 px-6 bg-white">
                <div class="container mx-auto max-w-6xl">
                    <h2 class="text-4xl font-black text-slate-900 mb-16 text-center italic">القطاعات الاستراتيجية الـ 16</h2>
                    <div id="sectors-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                </div>
            </div>
        </section>

        <!-- 2. Registration Wizard -->
        <section id="registration" class="page-section bg-slate-50">
            <div class="container mx-auto max-w-4xl py-12 px-6 text-right">
                <!-- Progress Bar -->
                <div class="flex justify-between items-center mb-16 relative px-4">
                    <div class="absolute top-1/2 left-0 w-full h-1 bg-slate-200 -z-10"></div>
                    <div id="progress-fill" class="absolute top-1/2 right-0 h-1 bg-amber-500 -z-10 transition-all duration-700" style="width: 0%"></div>
                    <div id="steps-container" class="contents">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <div class="bg-white p-12 lg:p-16 rounded-[3rem] shadow-2xl border border-slate-200 relative overflow-hidden">
                    <!-- Step 1 -->
                    <div id="step-1" class="step-content">
                        <h2 class="text-3xl font-black italic mb-10 border-b pb-6 text-slate-900">1. الملف التعريفي والجيومكاني</h2>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div><label class="label">اسم المشروع</label><input type="text" class="input-field" placeholder="سديم للتقنية"></div>
                            <div><label class="label">القطاع</label><select id="reg-sector" class="input-field"></select></div>
                            <div><label class="label">الدولة</label><input type="text" class="input-field" value="المملكة العربية السعودية"></div>
                            <div><label class="label">المدينة</label><select id="reg-city" class="input-field"></select></div>
                        </div>
                        <div class="flex justify-end pt-10"><button onclick="setStep(2)" class="bg-slate-900 text-white px-10 py-3 rounded-xl font-bold hover:scale-105 transition-all">التالي: المالية</button></div>
                    </div>
                    <!-- Step 2 -->
                    <div id="step-2" class="step-content hidden">
                        <h2 class="text-3xl font-black italic mb-10 border-b pb-6 text-slate-900">2. المؤشرات المالية</h2>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div><label class="label">صافي الربح (%)</label><input type="number" class="input-field" placeholder="25"></div>
                            <div><label class="label">التمويل ($)</label><input type="number" class="input-field" placeholder="10,000,000"></div>
                            <div class="md:col-span-2"><label class="label">نموذج العائد</label><textarea class="input-field h-24" placeholder="شرح النموذج..."></textarea></div>
                        </div>
                        <div class="flex justify-between pt-10">
                            <button onclick="setStep(1)" class="text-slate-400 font-bold">السابق</button>
                            <button onclick="setStep(3)" class="bg-slate-900 text-white px-10 py-3 rounded-xl font-bold hover:scale-105 transition-all">التالي: الخطة</button>
                        </div>
                    </div>
                    <!-- Step 3, 4, 5 (Simplified for brevity but structure exists) -->
                    <div id="step-3" class="step-content hidden">
                        <h2 class="text-3xl font-black italic mb-10 border-b pb-6 text-slate-900">3. خطة إدارة المشروع (PMP)</h2>
                        <div class="space-y-6">
                            <div><label class="label">ملخص التنفيذ</label><textarea class="input-field h-40" placeholder="تفاصيل التنفيذ..."></textarea></div>
                        </div>
                        <div class="flex justify-between pt-10">
                            <button onclick="setStep(2)" class="text-slate-400 font-bold">السابق</button>
                            <button onclick="setStep(4)" class="bg-slate-900 text-white px-10 py-3 rounded-xl font-bold hover:scale-105 transition-all">التالي: التشخيص</button>
                        </div>
                    </div>
                    <div id="step-4" class="step-content hidden">
                         <h2 class="text-3xl font-black italic mb-10 border-b pb-6 text-slate-900">4. مصفوفة التشخيص</h2>
                         <div class="space-y-4 bg-slate-50 p-6 rounded-2xl">
                             <div class="flex justify-between items-center"><span class="font-bold">هل تمتلك حقوق ملكية فكرية؟</span><input type="checkbox" class="w-5 h-5 accent-amber-500"></div>
                             <div class="flex justify-between items-center"><span class="font-bold">هل النموذج قابل للتوسع؟</span><input type="checkbox" class="w-5 h-5 accent-amber-500"></div>
                         </div>
                         <div class="flex justify-between pt-10">
                            <button onclick="setStep(3)" class="text-slate-400 font-bold">السابق</button>
                            <button onclick="setStep(5)" class="bg-slate-900 text-white px-10 py-3 rounded-xl font-bold hover:scale-105 transition-all">التالي: المراجعة</button>
                        </div>
                    </div>
                    <div id="step-5" class="step-content hidden text-center">
                        <div class="w-24 h-24 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-8"><i data-lucide="check-circle-2" class="w-12 h-12"></i></div>
                        <h2 class="text-4xl font-black italic mb-4">جاهز للإرسال</h2>
                        <p class="text-slate-500 text-lg mb-10">سيتم إرسال بياناتك إلى محرك Strategy BI.</p>
                        <button onclick="submitProject()" class="bg-green-600 text-white px-16 py-5 rounded-2xl font-black shadow-xl hover:scale-105 transition-all text-lg uppercase tracking-widest">إرسال وبدء التحليل</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Entrepreneur Dashboard -->
        <section id="ent-dash" class="page-section bg-slate-50">
            <div class="container mx-auto max-w-6xl py-12 px-6 text-right">
                <header class="mb-12 flex justify-between items-end border-b pb-8">
                    <div><h2 class="text-5xl font-black italic text-slate-900 uppercase">بوابة <span class="text-amber-500">النمو</span></h2><p class="text-slate-400 text-xs font-black mt-2 uppercase tracking-widest">متابعة الأصول</p></div>
                    <div class="bg-white px-5 py-2 rounded-xl border flex items-center gap-3 shadow-sm"><div class="w-2 h-2 bg-green-500 rounded-full animate-ping"></div><span class="text-[10px] font-black uppercase">نشط</span></div>
                </header>
                <div class="bg-white border border-slate-200 rounded-[2rem] p-8 lg:p-12 mb-10 flex flex-col lg:flex-row items-center gap-12 shadow-sm">
                     <div class="relative w-48 h-48 shrink-0 flex items-center justify-center">
                        <svg class="w-full h-full" viewBox="0 0 100 100"><circle class="text-slate-50" stroke-width="6" stroke="currentColor" fill="transparent" r="42" cx="50" cy="50" /><circle class="text-amber-500" stroke-width="8" stroke-dasharray="263.8" stroke-dashoffset="180" stroke-linecap="round" stroke="currentColor" fill="transparent" r="42" cx="50" cy="50" transform="rotate(-90 50 50)" /></svg>
                        <span class="absolute text-4xl font-black italic">68%</span>
                     </div>
                     <div class="grow w-full space-y-4">
                        <h3 class="text-3xl font-black italic">مرحلة العناية الواجبة (Due Diligence)</h3>
                        <p class="text-slate-600 text-lg">مشروعك يمر الآن بمرحلة التدقيق المالي. يرجى الانتظار.</p>
                        <button class="bg-slate-900 text-white px-8 py-3 rounded-xl font-bold text-xs uppercase hover:bg-slate-800">تحديث الملفات</button>
                     </div>
                </div>
            </div>
        </section>

        <!-- 4. Investor Dashboard -->
        <section id="inv-dash" class="page-section bg-slate-950 text-white">
            <div class="container mx-auto max-w-6xl py-12 px-6 text-right">
                <header class="mb-16 flex justify-between items-end border-b border-white/10 pb-8">
                    <div><h2 class="text-6xl font-black text-green-500 italic uppercase">عالم <span class="text-white">المستثمر</span></h2><p class="text-slate-500 text-xs font-black mt-4 uppercase tracking-[0.3em]">إدارة المحافظ السيادية</p></div>
                    <div class="text-right"><p className="text-xs text-slate-500 uppercase mb-2">إجمالي الأصول</p><p class="text-4xl font-black text-white">$450M</p></div>
                </header>
                <div id="investor-projects" class="space-y-4">
                    <!-- Projects Injected via JS -->
                </div>
            </div>
        </section>

        <!-- 5. Strategy BI Dashboard -->
        <section id="dashboard" class="page-section bg-slate-950 text-white">
            <div class="container mx-auto max-w-7xl py-12 px-6 text-right">
                <header class="flex flex-col md:flex-row justify-between items-end mb-16 gap-8">
                    <div>
                        <h2 class="text-7xl font-black text-blue-500 italic uppercase leading-none">Strategy <span class="text-white">BI</span></h2>
                        <p class="text-slate-500 text-xs font-black mt-4 uppercase tracking-[0.5em]">مركز التحكم الاستراتيجي</p>
                    </div>
                    <button onclick="navigateTo('map-view')" class="bg-blue-600 px-12 py-4 rounded-xl font-black text-xs uppercase shadow-lg hover:bg-blue-500 transition-colors">عرض الخريطة الواقعية</button>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
                    <div class="bg-white/5 p-8 rounded-3xl border border-white/10 col-span-2">
                        <h3 class="text-sm font-bold text-slate-400 uppercase mb-6">تدفقات السيولة</h3>
                        <div class="flex items-end gap-4 h-48">
                            <div class="w-full bg-blue-500/20 rounded-t-lg hover:bg-blue-500 transition-all" style="height: 40%"></div>
                            <div class="w-full bg-blue-500/20 rounded-t-lg hover:bg-blue-500 transition-all" style="height: 65%"></div>
                            <div class="w-full bg-blue-500/20 rounded-t-lg hover:bg-blue-500 transition-all" style="height: 45%"></div>
                            <div class="w-full bg-blue-500/20 rounded-t-lg hover:bg-blue-500 transition-all" style="height: 90%"></div>
                            <div class="w-full bg-blue-500/20 rounded-t-lg hover:bg-blue-500 transition-all" style="height: 60%"></div>
                        </div>
                    </div>
                    <div class="bg-white/5 p-8 rounded-3xl border border-white/10 flex flex-col justify-center items-center relative">
                        <h3 class="text-sm font-bold text-slate-400 uppercase mb-6 absolute top-8 right-8">المخاطر</h3>
                        <div class="w-48 h-48 rounded-full border-8 border-green-500 border-t-amber-500 border-r-blue-500 rotate-45"></div>
                        <div class="absolute inset-0 flex items-center justify-center font-black text-2xl">A+</div>
                    </div>
                </div>

                <div class="bg-white/5 border border-white/10 rounded-[2.5rem] overflow-hidden">
                    <div class="overflow-x-auto">
                         <table class="w-full text-right">
                           <thead class="bg-slate-900 text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] border-b border-white/10">
                             <tr>
                               <th class="p-8">بيانات الكيان</th>
                               <th class="p-8">المؤشرات المالية</th>
                               <th class="p-8">المخاطرة</th>
                               <th class="p-8">حالة المواءمة</th>
                               <th class="p-8">الإجراءات</th>
                             </tr>
                           </thead>
                           <tbody id="admin-table-body" class="divide-y divide-white/5">
                             <!-- Rows by JS -->
                           </tbody>
                         </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Real Map View -->
        <section id="map-view" class="page-section bg-slate-950 min-h-screen relative">
            <div class="container mx-auto max-w-7xl py-12 px-6">
                <button onclick="navigateTo('dashboard')" class="text-white mb-8 flex items-center gap-2 hover:text-amber-500 transition-colors"><i data-lucide="arrow-left" class="w-5 h-5"></i> عودة للوحة التحكم</button>
                <div class="relative w-full h-[650px] rounded-[3rem] overflow-hidden shadow-2xl border border-white/10">
                    <div id="real-map-container" class="w-full h-full bg-slate-900 z-0"></div>
                    <div class="absolute top-8 right-8 z-[1000] text-right pointer-events-none">
                        <h3 class="text-amber-500 font-black text-3xl italic uppercase drop-shadow-md">Live Asset Map</h3>
                        <p class="text-slate-300 text-xs font-bold uppercase tracking-[0.3em] mt-2 drop-shadow-md">نظام تتبع الأصول السيادية</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. Message Center -->
        <section id="messages" class="page-section bg-slate-50">
            <div class="container mx-auto max-w-6xl py-12 px-6 text-right">
                <header class="mb-10 flex justify-between items-center">
                    <h2 class="text-4xl font-black italic uppercase tracking-widest">Negotiation <span class="text-amber-500">Command</span></h2>
                    <button onclick="navigateTo('dashboard')" class="text-slate-400 font-bold flex items-center gap-2 text-[10px] uppercase italic hover:text-slate-900">العودة <i data-lucide="arrow-left" class="w-4 h-4"></i></button>
                </header>
                <div class="bg-white rounded-[3rem] border shadow-xl flex overflow-hidden min-h-[700px]">
                    <div id="msg-sidebar" class="w-1/3 border-l bg-slate-50 p-8 overflow-y-auto">
                        <h3 class="font-black text-slate-400 text-xs uppercase mb-6 tracking-widest">قنوات المفاوضات النشطة</h3>
                        <!-- Injected JS -->
                    </div>
                    <div class="w-2/3 flex flex-col relative bg-slate-50/30">
                        <div class="absolute inset-0 flex flex-col items-center justify-center text-slate-300 pointer-events-none">
                             <i data-lucide="send" class="w-16 h-16 mb-6 opacity-20"></i>
                             <p class="font-bold text-xl opacity-40">حدد قناة لبدء الإرسال الآمن</p>
                        </div>
                        <div class="mt-auto p-8 border-t bg-white flex gap-4 z-10">
                             <input type="text" placeholder="اكتب رسالة مشفرة..." class="grow bg-slate-50 border rounded-2xl px-6 py-4 font-bold outline-none focus:ring-2 focus:ring-amber-500 transition-all"/>
                             <button class="bg-slate-900 text-white p-4 rounded-2xl shadow-lg hover:scale-105 transition-all"><i data-lucide="send" class="w-6 h-6"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Project Modal -->
    <div id="modal" class="fixed inset-0 bg-slate-950/98 z-[5000] hidden items-center justify-center p-6 backdrop-blur-md overflow-y-auto">
        <div class="bg-white w-full max-w-6xl rounded-[3rem] overflow-hidden shadow-2xl border border-slate-200 text-right flex flex-col max-h-[95vh]">
            <div class="bg-amber-500 p-8 flex justify-between items-center shrink-0">
                <div><span class="bg-slate-950 text-white px-4 py-1 rounded-full text-[10px] font-black uppercase mb-3 inline-block">تحليل استراتيجي مكتمل</span><h2 id="modal-title" class="text-3xl font-black text-slate-950 italic"></h2></div>
                <button onclick="closeModal()" class="bg-black/10 p-3 rounded-2xl hover:bg-black/20 transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="p-10 lg:p-14 overflow-y-auto space-y-8">
                 <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                     <div class="p-6 bg-slate-50 rounded-2xl border text-center"><span class="text-slate-400 text-[10px] font-black uppercase block mb-2">صافي الربحية</span><span id="modal-profit" class="text-4xl font-black text-amber-600"></span></div>
                     <div class="p-6 bg-slate-50 rounded-2xl border text-center"><span class="text-slate-400 text-[10px] font-black uppercase block mb-2">التمويل المطلوب</span><span id="modal-funding" class="text-3xl font-black text-slate-900"></span></div>
                     <div class="p-6 bg-slate-50 rounded-2xl border text-center"><span class="text-slate-400 text-[10px] font-black uppercase block mb-2">المخاطرة</span><span id="modal-risk" class="text-2xl font-black text-slate-900"></span></div>
                     <div class="p-6 bg-slate-50 rounded-2xl border text-center"><span class="text-slate-400 text-[10px] font-black uppercase block mb-2">المواءمة</span><span id="modal-align" class="text-3xl font-black text-green-600"></span></div>
                 </div>
                 <div class="bg-slate-50 p-8 rounded-3xl border border-slate-200">
                      <h3 class="text-xl font-black mb-4 flex items-center gap-3"><i data-lucide="file-text" class="text-amber-500 w-5 h-5"></i> تقرير العناية الواجبة (Due Diligence)</h3>
                      <p class="text-slate-700 leading-loose text-lg">بناءً على تحليل البيانات الضخمة (Big Data)، يظهر هذا الكيان مؤشرات أداء تتفوق على متوسط السوق بنسبة 15%. الفريق المؤسس يمتلك خبرات تراكمية تتجاوز 20 عاماً، والملكية الفكرية مسجلة بالكامل.</p>
                 </div>
                 <div class="flex justify-end border-t pt-8">
                      <button onclick="closeModal(); navigateTo('messages');" class="bg-slate-900 text-white px-12 py-5 rounded-2xl font-black shadow-xl hover:scale-105 transition-all text-sm uppercase tracking-widest flex items-center gap-3">فتح غرفة العمليات <i data-lucide="send" class="w-5 h-5"></i></button>
                 </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Data ---
        const SECTORS = [
            "الذكاء الاصطناعي والأتمتة", "الأمن السيبراني المتطور", "التقنيات المالية (FinTech)", "تكنولوجيا الرعاية الصحية",
            "الطاقة المتجددة والنظيفة", "الخدمات اللوجستية الذكية", "التصنيع المتقدم (3D)", "التقنيات الزراعية (AgTech)",
            "التجارة الإلكترونية", "تكنولوجيا التعليم (EdTech)", "الاقتصاد الأخضر", "التكنولوجيا العقارية (PropTech)",
            "البرمجيات كخدمة (SaaS)", "تكنولوجيا الفضاء والطيران", "التقنية الحيوية (Biotech)", "الدفاع والأمن القومي"
        ];
        
        const CITIES = [
            { name: "الرياض", lat: 24.7136, lng: 46.6753 }, { name: "دبي", lat: 25.2048, lng: 55.2708 },
            { name: "جدة", lat: 21.5433, lng: 39.1728 }, { name: "الدوحة", lat: 25.2854, lng: 51.5310 },
            { name: "مسقط", lat: 23.5880, lng: 58.3829 }, { name: "الكويت", lat: 29.3759, lng: 47.9774 },
            { name: "القاهرة", lat: 30.0444, lng: 31.2357 }, { name: "المنامة", lat: 26.2285, lng: 50.5860 }
        ];

        let projects = Array.from({ length: 35 }, (_, i) => ({
            id: i + 1,
            name: `مشروع ${SECTORS[i % 16]} الاستراتيجي - ${Math.floor(i/10)+1}`,
            sector: SECTORS[i % 16],
            city: CITIES[i % CITIES.length].name,
            location: CITIES[i % CITIES.length],
            profit: 15 + Math.floor(Math.random() * 55),
            funding: (Math.random() * 80 + 10).toFixed(1),
            risk: ["Low", "Medium", "High"][i % 3],
            alignment: (Math.random() * 15 + 80).toFixed(1),
        }));

        let notifications = [];
        let mapInstance = null;
        let role = 'user';

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSectors();
            renderProjects();
            lucide.createIcons();
            addNotification("مرحباً بك في منصة كنوز. النظام جاهز.");
        });

        // --- Navigation ---
        function navigateTo(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0,0);
            
            if (pageId === 'map-view') initRealMap();
        }

        function setRole(newRole) {
            role = newRole;
            document.getElementById('nav-inv').classList.toggle('hidden', role !== 'investor');
            document.getElementById('nav-admin').classList.toggle('hidden', role !== 'admin');
            document.getElementById('nav-msgs').classList.toggle('hidden', role !== 'admin');
            
            ['user', 'investor', 'admin'].forEach(r => {
                const btn = document.getElementById(`btn-${r}`);
                if (r === role) btn.className = "px-4 py-1.5 rounded-full transition-all bg-white shadow-sm text-slate-900 font-bold border";
                else btn.className = "px-4 py-1.5 rounded-full transition-all text-slate-400";
            });

            addNotification(`تم تفعيل واجهة: ${role.toUpperCase()}`);
            if (role === 'admin') navigateTo('dashboard');
            else if (role === 'investor') navigateTo('inv-dash');
            else navigateTo('landing');
        }

        // --- Notifications ---
        function addNotification(text) {
            const time = new Date().toLocaleTimeString('ar-SA');
            notifications.unshift({ text, time });
            const list = document.getElementById('notif-list');
            const item = document.createElement('div');
            item.className = "p-4 bg-slate-50 border border-slate-100 rounded-2xl text-right hover:border-amber-200 transition-colors mb-2";
            item.innerHTML = `<span class="text-[10px] text-amber-600 font-black block mb-1 uppercase tracking-wider">${time}</span><p class="text-xs font-bold text-slate-700 leading-relaxed">${text}</p>`;
            if(notifications.length === 1) list.innerHTML = '';
            list.prepend(item);
            
            const badge = document.getElementById('notif-badge');
            badge.innerText = notifications.length;
            badge.classList.remove('hidden');

            showToast(text);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('opacity-0', 'pointer-events-none', 'translate-y-[-20px]');
            setTimeout(() => t.classList.add('opacity-0', 'pointer-events-none', 'translate-y-[-20px]'), 3000);
        }

        function toggleSidebar() { document.getElementById('notif-sidebar').classList.toggle('open'); }
        function clearNotifications() { 
            notifications = []; 
            document.getElementById('notif-list').innerHTML = '<div class="text-center text-slate-400 text-xs mt-10">لا توجد إشعارات</div>'; 
            document.getElementById('notif-badge').classList.add('hidden');
        }

        // --- Rendering ---
        function renderSectors() {
            const grid = document.getElementById('sectors-grid');
            const regSector = document.getElementById('reg-sector');
            const regCity = document.getElementById('reg-city');
            
            SECTORS.forEach(s => {
                grid.innerHTML += `<div class="p-6 bg-slate-50 border border-slate-100 rounded-3xl flex flex-col items-center text-center gap-4 hover:border-amber-500 hover:shadow-xl transition-all group cursor-pointer h-full"><div class="w-14 h-14 bg-white rounded-full flex items-center justify-center text-slate-400 group-hover:text-amber-500 shadow-sm border border-slate-100"><i data-lucide="cpu"></i></div><h3 class="font-bold text-sm text-slate-700 group-hover:text-slate-900">${s}</h3></div>`;
                const opt = document.createElement('option'); opt.value = s; opt.innerText = s;
                regSector.appendChild(opt);
            });
            CITIES.forEach(c => {
                const opt = document.createElement('option'); opt.value = c.name; opt.innerText = c.name;
                regCity.appendChild(opt);
            });
            
            // Render Wizard Steps Indicators
            const stepsContainer = document.getElementById('steps-container');
            for(let i=1; i<=5; i++){
                stepsContainer.innerHTML += `<div id="step-indicator-${i}" class="w-12 h-12 rounded-full flex items-center justify-center font-black border-4 text-lg transition-all ${i===1?'bg-amber-500 border-amber-500 text-white scale-110':'bg-white border-slate-200 text-slate-300'}">${i}</div>`;
            }
        }

        function renderProjects() {
            // Admin Table
            const tbody = document.getElementById('admin-table-body');
            // Investor List
            const invList = document.getElementById('investor-projects');
            // Message Sidebar
            const msgSidebar = document.getElementById('msg-sidebar');

            projects.slice(0, 10).forEach(p => {
                // Admin Row
                const row = `<tr class="hover:bg-white/5 transition-colors group">
                    <td class="p-8"><div class="font-bold text-white text-lg">${p.name}</div><div class="text-[10px] text-amber-500 uppercase mt-2 font-black">${p.sector} • ${p.city}</div></td>
                    <td class="p-8"><span class="text-green-400 font-bold text-lg block">${p.profit}% هامش ربح</span><span class="text-slate-400 text-xs">$${p.funding}M مطلوب</span></td>
                    <td class="p-8"><span class="px-4 py-1.5 rounded-full text-[10px] font-black uppercase border ${p.risk === 'Low' ? 'border-green-500 text-green-500' : 'border-amber-500 text-amber-500'}">${p.risk} RISK</span></td>
                    <td class="p-8"><div class="w-full bg-white/10 h-2 rounded-full overflow-hidden"><div class="h-full bg-blue-500" style="width: ${p.alignment}%"></div></div><span class="text-[10px] text-blue-400 block mt-2 font-bold">${p.alignment}% مطابقة</span></td>
                    <td class="p-8 flex gap-3"><button onclick="openModal(${p.id})" class="bg-white/10 p-3 rounded-xl text-white hover:bg-white hover:text-slate-900 transition-all shadow-lg"><i data-lucide="eye" class="w-5 h-5"></i></button></td>
                </tr>`;
                if(tbody) tbody.innerHTML += row;

                // Investor Card
                const card = `<div onclick="openModal(${p.id})" class="p-8 bg-white/5 border border-white/5 rounded-3xl flex flex-col md:flex-row justify-between items-center gap-6 hover:bg-white/10 cursor-pointer group"><div class="grow w-full"><h4 class="text-2xl font-black italic group-hover:text-amber-500 transition-colors">${p.name}</h4><p class="text-xs text-slate-500 font-bold uppercase mt-2 tracking-widest">${p.sector} • ${p.city}</p></div><div class="text-center"><p class="text-[9px] text-slate-500 uppercase mb-1">المواءمة</p><p class="text-3xl font-black text-green-400">${p.alignment}%</p></div></div>`;
                if(invList) invList.innerHTML += card;

                // Msg Item
                const msgItem = `<div class="p-4 bg-white border border-slate-200 rounded-2xl mb-3 cursor-pointer hover:border-amber-500 hover:shadow-md transition-all group"><p class="font-black text-sm truncate group-hover:text-amber-600">${p.name}</p><p class="text-[10px] text-slate-400 mt-1 flex items-center gap-1"><i data-lucide="lock" class="w-3 h-3"></i> مشفر</p></div>`;
                if(msgSidebar) msgSidebar.innerHTML += msgItem;
            });
        }

        // --- Wizard Logic ---
        function setStep(step) {
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`step-${step}`).classList.remove('hidden');
            document.getElementById('progress-fill').style.width = `${(step-1)*25}%`;
            
            for(let i=1; i<=5; i++){
                const ind = document.getElementById(`step-indicator-${i}`);
                if(step >= i) ind.className = "w-12 h-12 rounded-full flex items-center justify-center font-black border-4 text-lg transition-all bg-amber-500 border-amber-500 text-white scale-110";
                else ind.className = "w-12 h-12 rounded-full flex items-center justify-center font-black border-4 text-lg transition-all bg-white border-slate-200 text-slate-300";
            }
        }
        function submitProject() {
            addNotification("تم إرسال المشروع بنجاح ✅");
            navigateTo('ent-dash');
        }

        // --- Modal Logic ---
        function openModal(id) {
            const p = projects.find(x => x.id === id);
            if(!p) return;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-profit').innerText = p.profit + "%";
            document.getElementById('modal-funding').innerText = "$" + p.funding + "M";
            document.getElementById('modal-risk').innerText = p.risk;
            document.getElementById('modal-align').innerText = p.alignment + "%";
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
        }
        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
        }

        // --- Map Logic ---
        function initRealMap() {
            if(mapInstance) return;
            mapInstance = L.map('real-map-container').setView([25.0, 45.0], 5);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(mapInstance);

            const customIcon = L.divIcon({
                className: 'custom-div-icon',
                html: "<div style='background-color: #f59e0b; width: 12px; height: 12px; border-radius: 50%; box-shadow: 0 0 10px #f59e0b; border: 2px solid white;'></div>",
                iconSize: [12, 12],
                iconAnchor: [6, 6]
            });

            projects.forEach(p => {
                const offsetLat = (Math.random() - 0.5) * 0.1;
                const offsetLng = (Math.random() - 0.5) * 0.1;
                L.marker([p.location.lat + offsetLat, p.location.lng + offsetLng], { icon: customIcon })
                 .addTo(mapInstance)
                 .bindPopup(`<b>${p.name}</b><br>${p.sector}<br><button onclick="openModal(${p.id})" style="margin-top:5px; background:#f59e0b; border:none; padding:4px 8px; border-radius:4px; font-weight:bold; cursor:pointer;">التفاصيل</button>`);
            });
        }

    </script>
</body>
</html>
