<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة كنوز | Kunuz Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Inter:wght@300;400;600;800&display=swap');
        
        :root { --primary: #f59e0b; --bg-dark: #020617; }
        
        body { font-family: 'Cairo', 'Inter', sans-serif; scroll-behavior: smooth; overflow-x: hidden; background-color: #f8fafc; }
        .lang-en { font-family: 'Inter', sans-serif; }
        
        .hidden { display: none !important; }
        .active-section { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .admin-theme { background-color: var(--bg-dark); color: white; }
        
        /* Table & Card Responsiveness */
        @media (max-width: 1024px) {
            .responsive-table thead { display: none; }
            .responsive-table tr { display: block; margin-bottom: 1.5rem; background: rgba(255,255,255,0.05); border-radius: 1.5rem; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1); }
            .responsive-table td { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
            .responsive-table td:last-child { border: none; padding-top: 1rem; justify-content: center; }
            .responsive-table td::before { content: attr(data-label); font-weight: 900; color: #64748b; font-size: 0.7rem; text-transform: uppercase; }
        }

        #notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(120px); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 10000; }
        #notification.show { transform: translateX(-50%) translateY(0); }
        
        .progress-ring { transition: stroke-dashoffset 0.5s ease; transform: rotate(-90deg); transform-origin: 50% 50%; }
        #project-map { height: 450px; width: 100%; border-radius: 2rem; z-index: 1; }
    </style>
</head>
<body class="text-slate-900 bg-slate-50 transition-all duration-300">

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-slate-950 z-[11000] hidden flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-white font-black italic tracking-widest" id="loading-text">Kunuz Engine...</p>
    </div>

    <!-- Notification -->
    <div id="notification" class="bg-slate-950 text-white px-8 py-5 rounded-3xl shadow-2xl border border-white/10 flex items-center gap-4 min-w-[320px]">
        <div class="w-10 h-10 bg-amber-500 rounded-2xl flex items-center justify-center text-slate-950 shadow-lg"><i data-lucide="bell" class="w-5 h-5"></i></div>
        <div><p id="notification-text" class="text-xs font-black italic"></p></div>
    </div>

    <!-- Nav Bar -->
    <nav class="fixed top-0 w-full z-[1000] bg-white/90 backdrop-blur-xl border-b border-slate-100 px-4 lg:px-12 py-4 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3 cursor-pointer" onclick="showPage('landing')">
            <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center text-slate-950 font-black text-xl">K</div>
            <div class="hidden xs:block leading-none">
                <span class="text-xl font-black text-slate-950 block tracking-tighter uppercase">Kunuz <span class="text-amber-600 italic">Enterprise</span></span>
                <span class="text-[8px] text-slate-400 font-bold uppercase tracking-widest" data-i18n="nav-subtitle">Global Asset Intelligence</span>
            </div>
        </div>
        
        <div class="hidden lg:flex items-center gap-8 text-slate-600 font-black text-[10px] uppercase tracking-widest">
            <button onclick="showPage('landing')" data-i18n="nav-home">الرئيسية</button>
            <button onclick="showPage('ent-dash')" data-i18n="nav-founder">الرائد</button>
            <button id="nav-inv-btn" onclick="showPage('inv-dash')" class="hidden text-green-600" data-i18n="nav-investor">المستثمر</button>
            <button id="nav-adm-btn" onclick="showPage('dashboard')" class="hidden text-blue-600" data-i18n="nav-bi">Strategy BI</button>
            <button id="nav-msg-btn" onclick="showPage('messages')" class="hidden text-slate-400" data-i18n="nav-msg">الرسائل</button>
        </div>

        <div class="flex items-center gap-3">
            <!-- Language Toggle -->
            <button onclick="toggleLanguage()" class="bg-slate-100 px-3 py-1.5 rounded-xl text-[10px] font-black border flex items-center gap-2 hover:bg-slate-200 transition-all">
                <i data-lucide="languages" class="w-3 h-3"></i>
                <span id="lang-label">EN</span>
            </button>

            <div id="role-switcher" class="bg-slate-100 p-1 rounded-full flex gap-1 border">
                <button onclick="setRole('user')" id="role-user-btn" class="px-3 md:px-5 py-1.5 rounded-full text-[9px] font-black transition-all bg-white shadow-sm text-slate-900 border">User</button>
                <button onclick="setRole('investor')" id="role-inv-btn" class="px-3 md:px-5 py-1.5 rounded-full text-[9px] font-black transition-all text-slate-400">Inv</button>
                <button onclick="setRole('admin')" id="role-adm-btn" class="px-3 md:px-5 py-1.5 rounded-full text-[9px] font-black transition-all text-slate-400">Admin</button>
            </div>
            <button class="lg:hidden p-2 bg-slate-100 rounded-xl" onclick="toggleMobileMenu()"><i data-lucide="menu" class="w-5 h-5"></i></button>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-slate-950/98 z-[1500] hidden flex-col items-center justify-center text-white gap-8 font-black text-xl italic uppercase">
        <button onclick="toggleMobileMenu()" class="absolute top-6 right-6 p-4"><i data-lucide="x" class="w-8 h-8"></i></button>
        <button onclick="showPage('landing'); toggleMobileMenu()" data-i18n="nav-home">الرئيسية</button>
        <button onclick="showPage('ent-dash'); toggleMobileMenu()" data-i18n="nav-founder">الرائد</button>
        <button id="mob-inv-btn" class="hidden text-green-500" onclick="showPage('inv-dash'); toggleMobileMenu()" data-i18n="nav-investor">المستثمر</button>
        <button id="mob-adm-btn" class="hidden text-blue-500" onclick="showPage('dashboard'); toggleMobileMenu()" data-i18n="nav-bi">Strategy BI</button>
    </div>

    <main class="mt-[85px]">
        <!-- PAGE: LANDING -->
        <section id="landing-page" class="page-section active-section">
            <div class="relative py-24 lg:py-48 px-6 bg-slate-950 text-white min-h-[90vh] flex items-center overflow-hidden">
                <div class="container mx-auto grid lg:grid-cols-2 gap-16 items-center relative z-10">
                    <div class="text-right rtl:text-right ltr:text-left">
                        <span class="inline-block px-4 py-1 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-500 text-[10px] font-black uppercase mb-6 italic tracking-widest" data-i18n="hero-badge">Intelligent Acquisition Ecosystem</span>
                        <h1 class="text-5xl lg:text-8xl font-black mb-8 leading-[0.85] tracking-tighter italic" data-i18n="hero-title">أصولك <br><span class="text-amber-500">استراتيجية</span> رقمية</h1>
                        <p class="text-slate-400 text-lg mb-12 max-w-lg font-light leading-relaxed" data-i18n="hero-desc">منصة "كنوز" تدمج تحليل البيانات الضخمة (Strategy BI) مع مصفوفة التشخيص لربط المشاريع العملاقة بكبار المستثمرين.</p>
                        <div class="flex flex-wrap gap-4 justify-start">
                            <button onclick="showPage('form')" class="bg-amber-500 text-slate-950 px-10 py-5 rounded-2xl font-black shadow-2xl hover:scale-105 transition-all text-xs italic uppercase" data-i18n="btn-start">ابدأ رحلة التمويل</button>
                            <button onclick="setRole('admin')" class="bg-white/5 border border-white/10 px-8 py-5 rounded-2xl font-bold backdrop-blur-md text-xs italic uppercase" data-i18n="btn-bi">استعرض Strategy BI</button>
                        </div>
                    </div>
                    <div class="hidden lg:block">
                        <div class="glass-card rounded-[4rem] p-12 border border-white/10 shadow-2xl">
                            <h3 class="text-amber-500 font-black text-[10px] uppercase tracking-widest mb-10 italic">Live BI Monitor</h3>
                            <div class="space-y-10">
                                <div class="flex justify-between items-end"><p class="text-slate-500 text-[10px] font-black uppercase">Investor Match-Rate</p><p class="text-4xl font-black tracking-tighter">96.4%</p></div>
                                <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden"><div class="h-full bg-amber-500 w-[96%] animate-pulse"></div></div>
                                <div class="flex justify-between items-end"><p class="text-slate-500 text-[10px] font-black uppercase">Managed Asset Flow</p><p class="text-4xl font-black tracking-tighter text-blue-400 italic">+$1.4B</p></div>
                                <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden"><div class="h-full bg-blue-500 w-[82%]"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="py-24 bg-white px-6">
                <div class="container mx-auto">
                    <h2 class="text-4xl font-black text-slate-900 mb-20 tracking-tighter text-center italic" data-i18n="sect-title">القطاعات الاستراتيجية المشمولة</h2>
                    <div id="sectors-ref-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8"></div>
                </div>
            </div>
        </section>

        <!-- PAGE: ENTREPRENEUR DASHBOARD -->
        <section id="ent-dash-page" class="page-section hidden py-16 px-6 text-right">
            <div class="container mx-auto max-w-6xl">
                <header class="mb-12 flex flex-col md:flex-row justify-between items-end gap-6">
                    <div>
                        <h2 class="text-4xl font-black tracking-tighter italic uppercase tracking-widest">Growth <span class="text-amber-500">Center</span></h2>
                        <p class="text-slate-400 text-[10px] font-black mt-2 italic" data-i18n="dash-subtitle">تتبع تقدم مشروعك ومواءمة المستثمرين</p>
                    </div>
                    <div class="bg-white px-6 py-3 rounded-2xl border shadow-sm text-xs font-black text-green-500 italic" data-i18n="status-review">جاري المراجعة الاستراتيجية</div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
                    <div class="bg-white p-12 rounded-[3.5rem] shadow-xl border flex flex-col items-center justify-center text-center">
                        <div class="relative w-48 h-48 mb-6">
                            <svg class="w-full h-full" viewBox="0 0 100 100">
                                <circle class="text-slate-100" stroke-width="8" stroke="currentColor" fill="transparent" r="40" cx="50" cy="50" />
                                <circle class="text-amber-500 progress-ring" id="ready-progress-ent" stroke-width="8" stroke-dasharray="251.2" stroke-dashoffset="60" stroke-linecap="round" stroke="currentColor" fill="transparent" r="40" cx="50" cy="50" />
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span class="text-4xl font-black italic">76%</span>
                                <span class="text-[8px] font-black text-slate-400 uppercase mt-1">Readiness</span>
                            </div>
                        </div>
                        <h4 class="font-black text-slate-800 text-sm italic" data-i18n="mou-wait">بانتظار توقيع مذكرة التفاهم (MoU)</h4>
                    </div>

                    <div class="lg:col-span-2 bg-white p-10 rounded-[3.5rem] shadow-xl border overflow-hidden">
                        <div class="flex justify-between items-center mb-10">
                            <h4 class="font-black text-lg italic tracking-tighter" data-i18n="chart-title">التدفقات المالية والنمو (Quarterly)</h4>
                            <span class="text-[9px] font-black text-slate-400 uppercase italic">Real-time Metrics</span>
                        </div>
                        <div class="h-40 flex items-end gap-3 px-4" id="sales-flow-bars-ent">
                            <div class="bg-slate-100 w-full rounded-t-xl h-[30%]"></div>
                            <div class="bg-slate-100 w-full rounded-t-xl h-[45%]"></div>
                            <div class="bg-amber-500 w-full rounded-t-xl h-[85%] shadow-lg shadow-amber-500/20 animate-pulse"></div>
                            <div class="bg-slate-100 w-full rounded-t-xl h-[55%]"></div>
                            <div class="bg-slate-100 w-full rounded-t-xl h-[75%]"></div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-slate-950 text-white p-10 rounded-[2.5rem] flex items-center gap-6 shadow-2xl">
                        <div class="w-12 h-12 bg-amber-500 rounded-2xl flex items-center justify-center text-slate-950 shadow-lg"><i data-lucide="users"></i></div>
                        <div><p class="text-[8px] text-slate-500 font-black uppercase mb-1" data-i18n="stats-investors">المستثمرون المهتمون</p><p class="text-2xl font-black italic">14</p></div>
                    </div>
                    <div class="bg-white p-10 rounded-[2.5rem] border flex items-center gap-6">
                        <div class="w-12 h-12 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center"><i data-lucide="target"></i></div>
                        <div><p class="text-[8px] text-slate-400 font-black uppercase mb-1" data-i18n="stats-align">المواءمة الاستراتيجية</p><p class="text-2xl font-black italic">92%</p></div>
                    </div>
                    <div class="bg-white p-10 rounded-[2.5rem] border flex items-center gap-6">
                        <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center"><i data-lucide="clock"></i></div>
                        <div><p class="text-[8px] text-slate-400 font-black uppercase mb-1" data-i18n="stats-next">الموعد القادم</p><p class="text-2xl font-black italic tracking-tighter italic">MoU Review</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE: ADMIN STRATEGY BI -->
        <section id="dashboard-page" class="page-section hidden min-h-screen admin-theme py-16 px-6 text-right">
            <div class="container mx-auto">
                <header class="flex flex-col md:flex-row justify-between items-start md:items-end mb-16 gap-8">
                    <div>
                        <h2 class="text-6xl font-black tracking-tighter italic uppercase text-blue-500 italic">Strategy <span class="text-white">BI</span></h2>
                        <p class="text-slate-500 text-[10px] font-black mt-3 uppercase tracking-[0.4em] italic leading-loose" data-i18n="bi-subtitle">The Sovereign Intelligence & Massive Asset Control Center</p>
                    </div>
                    <div class="flex flex-wrap gap-4">
                        <button onclick="window.print()" class="bg-white/5 border border-white/10 px-8 py-4 rounded-2xl text-[9px] font-black uppercase italic hover:bg-white/10 transition-all"><i data-lucide="file-down" class="inline w-3 h-3 ml-2"></i> BI Report</button>
                        <button onclick="showPage('map')" class="bg-blue-600 px-10 py-4 rounded-2xl font-black text-xs shadow-xl italic tracking-tighter" data-i18n="btn-map">خارطة التدفقات</button>
                    </div>
                </header>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
                    <div class="glass-card p-10 rounded-[3rem] border-t-2 border-t-blue-500">
                        <p class="text-[9px] text-slate-500 font-black mb-2 uppercase italic" data-i18n="stat-active">الفرص النشطة</p>
                        <h3 id="stat-total" class="text-5xl font-black italic tracking-tighter text-white">0</h3>
                    </div>
                    <div class="glass-card p-10 rounded-[3rem] border-t-2 border-t-green-500">
                        <p class="text-[9px] text-slate-500 font-black mb-2 uppercase italic" data-i18n="stat-target">السيولة المستهدفة</p>
                        <h3 id="stat-total-funding" class="text-4xl font-black text-white">$0M</h3>
                    </div>
                    <div class="glass-card p-10 rounded-[3rem] border-t-2 border-t-amber-500">
                        <p class="text-[9px] text-slate-500 font-black mb-2 uppercase italic" data-i18n="stat-profit">متوسط الربحية</p>
                        <h3 id="stat-avg-profit" class="text-5xl font-black italic text-white tracking-tighter">0%</h3>
                    </div>
                    <div class="glass-card p-10 rounded-[3rem] border-t-2 border-t-purple-500">
                        <p class="text-[9px] text-slate-500 font-black mb-2 uppercase italic" data-i18n="stat-team">كفاءة الفريق</p>
                        <h3 id="stat-avg-team" class="text-5xl font-black italic text-white tracking-tighter">0/5</h3>
                    </div>
                </div>

                <div class="bg-white/5 p-8 lg:p-12 rounded-[4rem] border border-white/10 mb-12 backdrop-blur-xl">
                    <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-6 items-end text-right text-[10px] font-black italic">
                        <div class="lg:col-span-2">
                            <label class="text-slate-400 uppercase tracking-widest ml-2 mb-2 block" data-i18n="lbl-search">البحث الاستراتيجي العميق</label>
                            <input type="text" id="filter-search" oninput="applyFilters()" placeholder="..." class="w-full bg-slate-900 border border-white/10 rounded-2xl px-6 py-4 outline-none focus:ring-1 focus:ring-amber-500 text-white font-bold">
                        </div>
                        <div>
                            <label class="text-slate-400 uppercase tracking-widest ml-2 mb-2 block" data-i18n="lbl-sector">القطاع</label>
                            <select id="filter-sector" onchange="applyFilters()" class="w-full bg-slate-900 border border-white/10 rounded-2xl px-5 py-4 outline-none text-white font-bold"></select>
                        </div>
                        <div>
                            <label class="text-slate-400 uppercase tracking-widest ml-2 mb-2 block" data-i18n="lbl-risk">المخاطرة</label>
                            <select id="filter-risk" onchange="applyFilters()" class="w-full bg-slate-900 border border-white/10 rounded-2xl px-5 py-4 outline-none text-white font-bold">
                                <option value="all">All</option>
                                <option value="Low">Low Risk</option>
                                <option value="Medium">Medium Risk</option>
                                <option value="High">High Risk</option>
                            </select>
                        </div>
                        <div class="md:col-span-2 lg:col-span-1">
                            <label class="text-slate-400 uppercase tracking-widest ml-2 mb-2 block" data-i18n="lbl-profit">الربحية +%</label>
                            <input type="number" id="filter-profit-val" oninput="applyFilters()" class="w-full bg-slate-900 border border-white/10 rounded-2xl px-5 py-4 outline-none text-white">
                        </div>
                    </div>
                </div>

                <!-- Table Area -->
                <div class="bg-slate-900 rounded-[4rem] border border-white/5 overflow-hidden shadow-2xl relative">
                    <div class="overflow-x-auto custom-scrollbar">
                        <table class="w-full text-right responsive-table">
                            <thead class="bg-slate-950/80 text-slate-500 text-[9px] font-black uppercase tracking-[0.3em] italic">
                                <tr>
                                    <th class="p-8" data-i18n="th-entity">الكيان الاستراتيجي</th>
                                    <th class="p-8 text-center" data-i18n="th-profit">الربحية (%)</th>
                                    <th class="p-8 text-center" data-i18n="th-fund">التمويل ($M)</th>
                                    <th class="p-8 text-center" data-i18n="th-risk">المخاطرة</th>
                                    <th class="p-8 text-center" data-i18n="th-status">الحالة</th>
                                    <th class="p-8 text-center" data-i18n="th-action">إدارة القرار</th>
                                </tr>
                            </thead>
                            <tbody id="admin-table-body" class="divide-y divide-white/[0.03]"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE: INVESTOR DASHBOARD -->
        <section id="inv-dash-page" class="page-section hidden min-h-screen admin-theme py-16 px-6 text-right">
            <div class="container mx-auto">
                <header class="mb-16 flex flex-col lg:flex-row justify-between items-end gap-10">
                    <div>
                        <h2 class="text-5xl font-black tracking-tighter uppercase italic tracking-widest text-green-500 italic">Investor <span class="text-white">Universe</span></h2>
                        <p class="text-slate-500 text-[10px] font-black uppercase mt-4 tracking-[0.3em] italic" data-i18n="inv-subtitle">Portfolio Management & Pipeline Control</p>
                    </div>
                </header>
                <div id="investor-match-list" class="space-y-6"></div>
            </div>
        </section>

        <!-- PAGE: FORM -->
        <section id="form-page" class="page-section hidden py-20 bg-slate-50 min-h-screen">
            <div class="container mx-auto px-6 max-w-5xl">
                <div class="flex justify-between mb-20 relative px-10">
                    <div class="absolute top-1/2 left-0 w-full h-1 bg-slate-200 -translate-y-1/2 z-0"></div>
                    <div id="step-line" class="absolute top-1/2 left-0 w-0 h-1 bg-amber-500 -translate-y-1/2 z-0 transition-all duration-500"></div>
                    <div class="relative z-10 flex flex-col items-center gap-2"><div class="step-dot w-12 h-12 rounded-full bg-amber-500 text-slate-950 flex items-center justify-center font-black ring-4 ring-white shadow-xl italic">1</div></div>
                    <div class="relative z-10 flex flex-col items-center gap-2"><div class="step-dot w-12 h-12 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-black ring-4 ring-white italic">2</div></div>
                    <div class="relative z-10 flex flex-col items-center gap-2"><div class="step-dot w-12 h-12 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-black ring-4 ring-white italic">3</div></div>
                    <div class="relative z-10 flex flex-col items-center gap-2"><div class="step-dot w-12 h-12 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-black ring-4 ring-white italic">4</div></div>
                </div>

                <div id="form-step-1" class="active-step bg-white rounded-[4rem] p-12 lg:p-20 shadow-2xl border text-right">
                    <h2 class="text-4xl font-black mb-10 tracking-tighter italic border-b pb-8 italic" data-i18n="step1-title">أولاً: الملف التعريفي والموقع</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-2"><label class="text-[10px] font-black text-slate-500 uppercase italic tracking-widest" data-i18n="lbl-name">اسم المشروع</label><input type="text" id="f-name" class="w-full p-5 bg-slate-50 border rounded-2xl outline-none font-bold text-lg"></div>
                        <div class="space-y-2"><label class="text-[10px] font-black text-slate-500 uppercase italic tracking-widest" data-i18n="lbl-sector">القطاع</label><select id="f-sector" class="w-full p-5 bg-slate-50 border rounded-2xl outline-none font-bold text-lg"></select></div>
                    </div>
                    <div class="flex justify-end mt-12"><button onclick="nextStep(2)" class="bg-slate-950 text-white px-12 py-5 rounded-2xl font-black shadow-2xl hover:scale-105 transition-all text-sm uppercase italic" data-i18n="btn-next">التالي</button></div>
                </div>
                <!-- ... additional steps are handled via JS ... -->
                <div id="form-step-4" class="hidden bg-white rounded-[4rem] p-12 lg:p-20 shadow-2xl border text-right">
                    <h2 class="text-4xl font-black mb-12 tracking-tighter text-center italic uppercase tracking-widest italic" data-i18n="diag-title">مصفوفة التشخيص الاستراتيجي النهائي</h2>
                    <div id="diagnosis-questions-container" class="space-y-8 mb-12 text-right"></div>
                    <div class="flex justify-between mt-12 border-t pt-10"><button onclick="submitDiagnostics()" class="bg-amber-500 text-slate-950 px-16 py-6 rounded-3xl font-black shadow-2xl hover:scale-105 transition-all italic text-xl tracking-tighter uppercase italic" data-i18n="btn-submit">إرسال المشروع للتحليل الذكي BI</button></div>
                </div>
            </div>
        </section>

        <!-- PAGE: MESSAGES -->
        <section id="messages-page" class="page-section hidden min-h-screen bg-slate-50 py-16 px-6 text-right">
            <div class="container mx-auto max-w-6xl">
                <header class="mb-12 flex justify-between items-center">
                    <h2 class="text-3xl font-black italic tracking-tighter uppercase tracking-widest">Negotiation <span class="text-amber-500 italic">Command</span></h2>
                </header>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-10 bg-white rounded-[4rem] border shadow-2xl overflow-hidden min-h-[700px]">
                    <div class="border-l bg-slate-50/50 p-10 space-y-6 overflow-y-auto custom-scrollbar">
                        <div id="chat-list" class="space-y-4"></div>
                    </div>
                    <div class="lg:col-span-2 flex flex-col h-full bg-white text-center italic font-bold text-slate-300 items-center justify-center p-12">
                        <p data-i18n="msg-prompt">يرجى اختيار مشروع لبدء المفاوضة الاستراتيجية</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE: MAP -->
        <section id="map-page" class="page-section hidden py-24 admin-theme text-white min-h-screen px-6">
            <div class="container mx-auto text-center">
                <h2 class="text-5xl font-black text-amber-500 tracking-tighter italic mb-4 uppercase italic tracking-widest">Geospatial Asset Map</h2>
                <div id="project-map" class="shadow-2xl border border-white/10 mt-12 relative z-10"></div>
            </div>
        </section>
    </main>

    <!-- PROJECT DETAIL MODAL -->
    <div id="details-modal" class="fixed inset-0 bg-slate-950/98 z-[20000] hidden items-center justify-center p-4 lg:p-12 backdrop-blur-3xl overflow-y-auto">
        <div class="bg-white rounded-[4rem] w-full max-w-6xl overflow-hidden shadow-2xl flex flex-col max-h-[92vh] text-right">
            <div id="modal-view-main" class="flex flex-col h-full">
                <div class="p-10 bg-amber-500 flex justify-between items-center text-slate-950 shrink-0">
                    <div>
                        <span id="modal-status-badge" class="bg-slate-950 text-white text-[9px] px-3 py-1 rounded-full font-black uppercase mb-3 inline-block italic">Strategic Match</span>
                        <h3 id="modal-title" class="text-4xl font-black tracking-tighter italic uppercase italic">Project Dossier</h3>
                    </div>
                    <button onclick="closeModal()" class="w-16 h-16 bg-slate-950/10 rounded-[2.5rem] flex items-center justify-center hover:bg-slate-950/20 group transition-all"><i data-lucide="x" class="w-8 h-8 group-hover:rotate-90"></i></button>
                </div>
                <div class="overflow-y-auto p-10 lg:p-16 grow space-y-16 custom-scrollbar">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                        <div class="lg:col-span-2 space-y-12">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="modal-metrics-grid"></div>
                            <div class="bg-slate-50 p-10 rounded-[3rem] border">
                                <h4 class="font-black text-slate-900 text-xl italic flex items-center gap-4 mb-10"><i data-lucide="file-text"></i> Strategic Assets</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="p-6 bg-white border rounded-3xl flex justify-between items-center cursor-pointer hover:border-amber-500 transition-all">
                                        <div class="flex items-center gap-4"><i data-lucide="file-bar-chart"></i><p class="text-xs font-black">BI_Report.pdf</p></div>
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="admin-actions-sidebar" class="hidden">
                            <div class="bg-slate-950 text-white p-10 rounded-[3.5rem] border border-white/5 space-y-8 shadow-2xl">
                                <h4 class="text-amber-500 font-black text-[10px] uppercase tracking-widest italic border-b border-white/10 pb-6 italic">Strategy BI Action</h4>
                                <button onclick="showAcquisitionRoom()" class="w-full bg-amber-500 text-slate-950 py-6 rounded-[2.5rem] font-black shadow-2xl hover:scale-105 transition-all italic tracking-tighter text-lg uppercase italic">War Room <i data-lucide="zap"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- War Room View (Hidden by default) -->
            <div id="modal-view-acquisition" class="hidden flex flex-col h-full bg-slate-50">
                 <div class="p-10 bg-slate-950 text-white flex justify-between items-center shrink-0">
                    <div class="flex items-center gap-6"><button onclick="backToMainView()" class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center hover:bg-white/20 transition-all"><i data-lucide="chevron-right" class="w-6 h-6"></i></button><div><h3 class="text-4xl font-black tracking-tighter italic uppercase text-amber-500">Negotiation <span class="text-white">WAR ROOM</span></h3></div></div>
                </div>
                <div id="acq-path-selection" class="p-16 grow flex flex-col justify-center items-center gap-12 text-center">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-5xl">
                        <div onclick="activatePath('Buyout')" class="p-12 bg-white rounded-[4rem] border cursor-pointer hover:border-amber-500 shadow-xl group transition-all"><h4 class="font-black text-xl italic uppercase">Acquisition</h4></div>
                        <div onclick="activatePath('Partner')" class="p-12 bg-white rounded-[4rem] border cursor-pointer hover:border-amber-500 shadow-xl group transition-all"><h4 class="font-black text-xl italic uppercase">Partnership</h4></div>
                        <div onclick="activatePath('Match')" class="p-12 bg-white rounded-[4rem] border cursor-pointer hover:border-amber-500 shadow-xl group transition-all"><h4 class="font-black text-xl italic uppercase">Matching</h4></div>
                    </div>
                </div>
                <div id="acq-active-room" class="hidden p-10 grow overflow-hidden flex flex-col lg:flex-row gap-8">
                    <div class="grow bg-white rounded-[4rem] shadow-2xl flex flex-col border overflow-hidden">
                        <div id="chat-messages-live" class="grow p-10 overflow-y-auto space-y-10 custom-scrollbar bg-slate-50/20 italic font-bold"></div>
                        <div class="p-10 border-t flex gap-4"><input type="text" placeholder="..." class="grow bg-slate-50 border rounded-2xl px-6 py-4 outline-none font-bold text-sm"><button class="bg-slate-950 text-white px-8 py-4 rounded-2xl shadow-xl">Send</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map, markersGroup, projects = [], currentProjectId = null, userRole = 'user';
        let currentLang = 'ar';

        const i18n = {
            ar: {
                'nav-subtitle': 'نظام ذكاء الأصول العالمي',
                'nav-home': 'الرئيسية',
                'nav-founder': 'الرائد',
                'nav-investor': 'المستثمر',
                'nav-bi': 'Strategy BI',
                'nav-msg': 'الرسائل',
                'hero-badge': 'نظام الاستحواذ الذكي',
                'hero-title': 'أصولك <br><span class="text-amber-500">استراتيجية</span> رقمية',
                'hero-desc': 'منصة "كنوز" تدمج تحليل البيانات الضخمة (Strategy BI) مع مصفوفة التشخيص لربط المشاريع العملاقة بكبار المستثمرين.',
                'btn-start': 'ابدأ رحلة التمويل',
                'btn-bi': 'استعرض Strategy BI',
                'sect-title': 'القطاعات الاستراتيجية المشمولة',
                'dash-subtitle': 'تتبع تقدم مشروعك ومواءمة المستثمرين',
                'status-review': 'جاري المراجعة الاستراتيجية',
                'mou-wait': 'بانتظار توقيع مذكرة التفاهم (MoU)',
                'chart-title': 'التدفقات المالية والنمو (ربع سنوي)',
                'stats-investors': 'المستثمرون المهتمون',
                'stats-align': 'المواءمة الاستراتيجية',
                'stats-next': 'الموعد القادم',
                'bi-subtitle': 'نظام السيادة الاستخباراتي والتحكم بالأصول الضخمة',
                'btn-map': 'خارطة التدفقات',
                'stat-active': 'الفرص النشطة',
                'stat-target': 'السيولة المستهدفة',
                'stat-profit': 'متوسط الربحية',
                'stat-team': 'كفاءة الفريق',
                'lbl-search': 'البحث الاستراتيجي العميق',
                'lbl-sector': 'القطاع',
                'lbl-risk': 'المخاطرة',
                'lbl-profit': 'الربحية +%',
                'th-entity': 'الكيان الاستراتيجي',
                'th-profit': 'الربحية (%)',
                'th-fund': 'التمويل ($M)',
                'th-risk': 'المخاطرة',
                'th-status': 'الحالة',
                'th-action': 'إدارة القرار',
                'msg-prompt': 'يرجى اختيار مشروع لبدء المفاوضة الاستراتيجية',
                'step1-title': 'أولاً: الملف التعريفي والموقع',
                'lbl-name': 'اسم المشروع / الكيان',
                'diag-title': 'مصفوفة التشخيص الاستراتيجي النهائي',
                'btn-submit': 'إرسال المشروع للتحليل الذكي BI',
                'btn-next': 'التالي',
                'notif-success': 'تم تنفيذ الإجراء بنجاح',
                'notif-lang': 'تم تغيير اللغة إلى العربية',
                'inv-subtitle': 'إدارة المحفظة والتحكم في التدفقات'
            },
            en: {
                'nav-subtitle': 'Global Asset Intelligence',
                'nav-home': 'Home',
                'nav-founder': 'Founder',
                'nav-investor': 'Investor',
                'nav-bi': 'Strategy BI',
                'nav-msg': 'Messages',
                'hero-badge': 'Intelligent Acquisition Ecosystem',
                'hero-title': 'Digital <br><span class="text-amber-500">Strategic</span> Assets',
                'hero-desc': 'Kunuz Platform integrates Big Data analytics (Strategy BI) with diagnostic matrices to link major projects with top-tier investors.',
                'btn-start': 'Start Funding Journey',
                'btn-bi': 'Review Strategy BI',
                'sect-title': 'Strategic Sectors Covered',
                'dash-subtitle': 'Track progress and investor alignment',
                'status-review': 'Strategic Review Ongoing',
                'mou-wait': 'Awaiting MoU Signing',
                'chart-title': 'Financial Flow & Growth (Quarterly)',
                'stats-investors': 'Interested Investors',
                'stats-align': 'Strategic Alignment',
                'stats-next': 'Next Appointment',
                'bi-subtitle': 'The Sovereign Intelligence & Massive Asset Control Center',
                'btn-map': 'Flow Map',
                'stat-active': 'Active Leads',
                'stat-target': 'Target Liquidity',
                'stat-profit': 'Avg Profitability',
                'stat-team': 'Team Efficiency',
                'lbl-search': 'Deep Strategic Search',
                'lbl-sector': 'Sector',
                'lbl-risk': 'Risk',
                'lbl-profit': 'Profit +%',
                'th-entity': 'Strategic Entity',
                'th-profit': 'Profit (%)',
                'th-fund': 'Fund ($M)',
                'th-risk': 'Risk',
                'th-status': 'Status',
                'th-action': 'Decision',
                'msg-prompt': 'Select a project to start strategic negotiation',
                'step1-title': 'First: Profile & Location',
                'lbl-name': 'Project / Entity Name',
                'diag-title': 'Final Strategic Diagnosis Matrix',
                'btn-submit': 'Submit for BI Analysis',
                'btn-next': 'Next Step',
                'notif-success': 'Action executed successfully',
                'notif-lang': 'Language changed to English',
                'inv-subtitle': 'Portfolio Management & Pipeline Control'
            }
        };

        const SECTORS = [
            "AI & Automation", "Cyber Security", "FinTech", "Smart Logistics", 
            "Sustainable Energy", "AgTech", "HealthTech", "Advanced E-Commerce"
        ];

        const REALISTIC_COMPANIES = [
            "Sadeem Digital Solutions", "Namaa AgTech", "Maal Financials", "Ofoq Logistics",
            "Rawabi Green Energy", "Tharaa AI", "Shield Cyber", "Kayan E-Commerce"
        ];

        const CITY_COORDS = { "Riyadh": [24.71, 46.67], "Dubai": [25.20, 55.27], "Jeddah": [21.48, 39.19], "Cairo": [30.04, 31.23] };

        const SMART_QUESTIONS = [
            { q:1, text: "Core Value Driver?", opts: [{v:"A", t:"Physical Assets"}, {v:"B", t:"Digital Algorithms"}, {v:"C", t:"IP & Big Data"}] },
            { q:2, text: "Scalability Model?", opts: [{v:"A", t:"Physical Branching"}, {v:"B", t:"Local Digital"}, {v:"C", t:"Global Replication"}] },
            { q:3, text: "Third Party Dependency?", opts: [{v:"A", t:"Fully Dependent"}, {v:"B", t:"Partial APIs"}, {v:"C", t:"Proprietary Tech"}] }
        ];

        function autoDetectLanguage() {
            const browserLang = navigator.language.split('-')[0];
            currentLang = browserLang === 'ar' ? 'ar' : 'en';
            applyTranslations();
        }

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            applyTranslations();
            showNotification(i18n[currentLang]['notif-lang']);
        }

        function applyTranslations() {
            const root = document.documentElement;
            const body = document.body;
            root.lang = currentLang;
            root.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            body.className = currentLang === 'en' ? 'text-slate-900 bg-slate-50 lang-en' : 'text-slate-900 bg-slate-50';
            
            document.getElementById('lang-label').textContent = currentLang === 'ar' ? 'EN' : 'عربي';

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[currentLang][key]) {
                    el.innerHTML = i18n[currentLang][key];
                }
            });
            
            // Re-render table and matches to respect language
            applyFilters();
            renderInvestorMatches();
            renderChatList();
        }

        function seedData() {
            projects = [];
            const cities = Object.keys(CITY_COORDS);
            for(let i=1; i<=25; i++) {
                const city = cities[i % cities.length];
                const profit = 15 + Math.floor(Math.random() * 45);
                const funding = (Math.random() * 45 + 5).toFixed(1);
                projects.push({
                    id: i, name: REALISTIC_COMPANIES[i % REALISTIC_COMPANIES.length] + " " + (i),
                    sector: SECTORS[i % SECTORS.length], city: city, coords: CITY_COORDS[city], country: "KSA",
                    profit: profit, funding: funding, risk: ["Low", "Medium", "High"][i % 3], teamRating: (Math.random()*2+3).toFixed(1),
                    status: 'Active', alignment: (Math.random()*15+82).toFixed(1)
                });
            }
        }

        function init() {
            seedData();
            autoDetectLanguage();
            const sectorRef = document.getElementById('sectors-ref-container');
            const filSector = document.getElementById('filter-sector');
            const fSector = document.getElementById('f-sector');
            
            if(filSector) filSector.innerHTML = '<option value="all">All Sectors</option>';
            SECTORS.forEach(s => {
                const opt = document.createElement('option'); opt.value = s; opt.textContent = s;
                if(filSector) filSector.appendChild(opt.cloneNode(true));
                if(fSector) fSector.appendChild(opt);
                if(sectorRef) {
                    const div = document.createElement('div');
                    div.className = "bg-slate-50 p-10 rounded-[3rem] border group hover:bg-white hover:shadow-2xl transition-all text-right ltr:text-left";
                    div.innerHTML = `<h4 class="font-black text-slate-800 mb-2 italic text-lg tracking-tighter">${s}</h4><p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest italic">Asset Intelligence Hub</p>`;
                    sectorRef.appendChild(div);
                }
            });

            const qContainer = document.getElementById('diagnosis-questions-container');
            if(qContainer) {
                SMART_QUESTIONS.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "bg-slate-50 p-10 rounded-[4rem] border border-slate-100 shadow-sm";
                    div.innerHTML = `<p class="font-black text-slate-800 mb-8 italic text-lg border-r-4 border-amber-500 pr-4">${item.text}</p><div class="grid grid-cols-1 md:grid-cols-3 gap-6">${item.opts.map(o => `<label class="flex items-center gap-4 p-5 bg-white rounded-[2rem] border-2 cursor-pointer hover:border-amber-500 transition-all font-black text-xs italic"><input type="radio" name="q${item.q}" value="${o.v}" class="w-6 h-6 accent-amber-500"> ${o.t}</label>`).join('')}</div>`;
                    qContainer.appendChild(div);
                });
            }

            initMap();
            applyFilters();
            renderInvestorMatches();
            renderChatList();
            if(typeof lucide !== 'undefined') lucide.createIcons();
        }

        function setRole(role) {
            userRole = role;
            ['user', 'inv', 'adm'].forEach(r => {
                const btn = document.getElementById(`role-${r}-btn`);
                if(btn) btn.className = r === role ? "px-3 md:px-5 py-1.5 rounded-full text-[9px] font-black transition-all bg-white shadow-sm text-slate-900 border" : "px-3 md:px-5 py-1.5 rounded-full text-[9px] font-black transition-all text-slate-400";
            });
            document.getElementById('nav-inv-btn').classList.toggle('hidden', role !== 'investor');
            document.getElementById('nav-adm-btn').classList.toggle('hidden', role !== 'admin');
            document.getElementById('nav-msg-btn').classList.toggle('hidden', role !== 'admin');
            
            if(role === 'admin') showPage('dashboard'); else if(role === 'investor') showPage('inv-dash'); else showPage('landing');
        }

        function applyFilters() {
            const search = document.getElementById('filter-search')?.value.toLowerCase() || "";
            const sector = document.getElementById('filter-sector')?.value || "all";
            const risk = document.getElementById('filter-risk')?.value || "all";
            const profitVal = parseFloat(document.getElementById('filter-profit-val')?.value) || 0;

            const filtered = projects.filter(p => {
                const sMatch = p.name.toLowerCase().includes(search) || p.city.toLowerCase().includes(search);
                const sectorMatch = sector === 'all' || p.sector === sector;
                const riskMatch = risk === 'all' || p.risk === risk;
                const profitMatch = p.profit >= profitVal;
                return sMatch && sectorMatch && riskMatch && profitMatch;
            });

            renderTable(filtered);
            updateStats(filtered);
            renderMapMarkers(filtered);
        }

        function renderTable(data) {
            const tbody = document.getElementById('admin-table-body');
            if(!tbody) return;
            tbody.innerHTML = data.map(p => `
                <tr class="hover:bg-white/[0.04] transition-all group">
                    <td class="p-8" data-label="${i18n[currentLang]['th-entity']}"><div><div class="font-black text-slate-100 italic tracking-tighter text-lg">${p.name}</div><div class="text-[9px] text-amber-500 font-black uppercase mt-1 italic tracking-[0.2em] italic">${p.sector}</div></div></td>
                    <td class="p-8 text-center font-black text-amber-500 text-xl italic" data-label="${i18n[currentLang]['th-profit']}">${p.profit}%</td>
                    <td class="p-8 text-center font-black text-slate-300 italic" data-label="${i18n[currentLang]['th-fund']}">$${p.funding}M</td>
                    <td class="p-8 text-center" data-label="${i18n[currentLang]['th-risk']}"><span class="px-3 py-1 rounded-full text-[8px] font-black uppercase border border-amber-500 text-amber-500 italic">${p.risk}</span></td>
                    <td class="p-8 text-center" data-label="${i18n[currentLang]['th-status']}"><span class="text-[8px] font-black px-4 py-2 bg-white/5 rounded-full text-green-500 uppercase italic">${p.status}</span></td>
                    <td class="p-8 text-center" data-label="${i18n[currentLang]['th-action']}"><button onclick="viewProject(${p.id})" class="text-amber-500 hover:scale-125 transition-transform"><i data-lucide="microscope" class="w-6 h-6"></i></button></td>
                </tr>
            `).join('');
            lucide.createIcons();
        }

        function updateStats(data) {
            const t = data.length;
            const funding = data.reduce((a, b) => a + parseFloat(b.funding), 0).toFixed(0);
            const profit = t > 0 ? (data.reduce((a, b) => a + b.profit, 0) / t).toFixed(1) : 0;
            const team = t > 0 ? (data.reduce((a, b) => a + parseFloat(b.teamRating), 0) / t).toFixed(1) : 0;
            if(document.getElementById('stat-total')) document.getElementById('stat-total').textContent = t;
            if(document.getElementById('stat-total-funding')) document.getElementById('stat-total-funding').textContent = `$${funding}M`;
            if(document.getElementById('stat-avg-profit')) document.getElementById('stat-avg-profit').textContent = `${profit}%`;
            if(document.getElementById('stat-avg-team')) document.getElementById('stat-avg-team').textContent = `${team}/5`;
        }

        function renderInvestorMatches() {
            const container = document.getElementById('investor-match-list');
            if(!container) return;
            const matches = projects.sort((a,b) => b.alignment - a.alignment).slice(0, 8);
            container.innerHTML = matches.map(p => `
                <div class="flex flex-col lg:flex-row items-center justify-between p-10 glass-card rounded-[3rem] hover:bg-white/10 transition-all gap-8">
                    <div class="flex items-center gap-8">
                        <div class="w-16 h-16 bg-green-500/20 text-green-400 rounded-[2rem] flex items-center justify-center font-black text-2xl shadow-2xl">${p.alignment}%</div>
                        <div class="text-right ltr:text-left"><h4 class="font-black text-2xl italic tracking-tighter">${p.name}</h4><p class="text-[9px] text-slate-500 font-black uppercase mt-2 italic">${p.sector} • ${p.city}</p></div>
                    </div>
                    <div class="flex flex-wrap items-center gap-10">
                        <div class="text-center border-r border-white/5 pr-10 rtl:border-r rtl:border-l-0 ltr:border-l ltr:border-r-0 ltr:pl-10"><p class="text-[9px] text-slate-500 font-black mb-1 uppercase">Fund Cap</p><p class="text-white font-black text-2xl italic tracking-tighter">$${p.funding}M</p></div>
                        <button onclick="viewProject(${p.id})" class="bg-green-500 text-slate-950 px-10 py-5 rounded-3xl font-black text-xs uppercase shadow-2xl hover:scale-105 transition-all">Analysis</button>
                    </div>
                </div>
            `).join('');
        }

        function viewProject(id) {
            currentProjectId = id;
            const p = projects.find(x => x.id == id);
            if(!p) return;
            document.getElementById('modal-title').textContent = p.name;
            document.getElementById('modal-metrics-grid').innerHTML = `
                <div class="bg-slate-50 p-8 rounded-[2.5rem] border"><span class="text-slate-400 block text-[9px] uppercase font-black italic mb-2 tracking-widest italic">Location</span><p class="font-black text-slate-800 text-lg">${p.city}</p></div>
                <div class="bg-slate-50 p-8 rounded-[2.5rem] border"><span class="text-slate-400 block text-[9px] uppercase font-black italic mb-2 tracking-widest italic">ROI</span><p class="font-black text-amber-600 text-3xl italic tracking-tighter">${p.profit}%</p></div>
                <div class="bg-slate-50 p-8 rounded-[2.5rem] border"><span class="text-slate-400 block text-[9px] uppercase font-black italic mb-2 tracking-widest italic">Funding</span><p class="font-black text-slate-800 text-2xl italic tracking-tighter">$${p.funding}M</p></div>
                <div class="bg-slate-50 p-8 rounded-[2.5rem] border"><span class="text-slate-400 block text-[9px] uppercase font-black italic mb-2 tracking-widest italic">Alignment</span><p class="font-black text-green-600 text-2xl italic tracking-tighter">${p.alignment}%</p></div>
                <div class="bg-slate-50 p-8 rounded-[2.5rem] border"><span class="text-slate-400 block text-[9px] uppercase font-black italic mb-2 tracking-widest italic">Risk</span><p class="font-black text-slate-800 text-xl uppercase italic">${p.risk}</p></div>
            `;
            document.getElementById('admin-actions-sidebar').classList.toggle('hidden', userRole !== 'admin');
            backToMainView();
            document.getElementById('details-modal').classList.remove('hidden');
            document.getElementById('details-modal').classList.add('flex');
            lucide.createIcons();
        }

        function initMap() {
            const mapEl = document.getElementById('project-map');
            if(!mapEl || map) return;
            map = L.map('project-map').setView([24, 45], 4);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
            markersGroup = L.layerGroup().addTo(map);
        }

        function renderMapMarkers(data) {
            if(!markersGroup) return;
            markersGroup.clearLayers();
            data.forEach(p => {
                if(p.coords) {
                    const icon = L.divIcon({ className: 'custom-icon', html: `<div style="background:#f59e0b;width:16px;height:16px;border:2px solid white;border-radius:50%;"></div>`, iconSize: [16, 16] });
                    L.marker(p.coords, { icon: icon }).addTo(markersGroup).bindPopup(`<div class="text-right font-black italic p-2"><p class="text-amber-500 mb-2">${p.name}</p><button onclick="viewProject(${p.id})" class="w-full py-2 bg-amber-500 rounded-xl">BI Analysis</button></div>`);
                }
            });
        }

        function showPage(id) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.add('hidden'));
            const el = document.getElementById(`${id}-page`);
            if(el) {
                el.classList.add('active-section'); 
                el.classList.remove('hidden');
            }
            if(id === 'form') fillDefaultFormData();
            if(id === 'map' && map) setTimeout(() => map.invalidateSize(), 300);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showNotification(text) { 
            const toast = document.getElementById('notification'); 
            document.getElementById('notification-text').textContent = text; 
            toast.classList.add('show'); 
            setTimeout(() => toast.classList.remove('show'), 4000); 
        }

        function closeModal() { document.getElementById('details-modal').classList.add('hidden'); }
        function showAcquisitionRoom() { document.getElementById('modal-view-main').classList.add('hidden'); document.getElementById('modal-view-acquisition').classList.remove('hidden'); lucide.createIcons(); }
        function backToMainView() { document.getElementById('modal-view-acquisition').classList.add('hidden'); document.getElementById('modal-view-main').classList.remove('hidden'); document.getElementById('acq-path-selection').classList.remove('hidden'); document.getElementById('acq-active-room').classList.add('hidden'); }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); document.getElementById('mobile-menu').classList.toggle('flex'); }

        function fillDefaultFormData() {
            document.getElementById('f-name').value = "Sadeem Cloud & AI Hub";
            document.getElementById('f-sector').value = "AI & Automation";
            document.getElementById('f-country').value = "KSA";
            document.getElementById('f-city').value = "Riyadh";
            document.querySelectorAll('input[type="radio"]').forEach((el, i) => { if((i+1)%3 === 0) el.checked = true; });
        }

        function nextStep(s) { 
            document.querySelectorAll('[id^="form-step-"]').forEach(d => d.classList.add('hidden'));
            document.getElementById(`form-step-${s}`).classList.remove('hidden');
            document.getElementById('step-line').style.width = `${(s-1)*33.33}%`;
        }

        function submitDiagnostics() {
            document.getElementById('loading-screen').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
                showNotification(i18n[currentLang]['notif-success']);
                showPage('ent-dash');
            }, 2000);
        }

        window.onload = init;
    </script>
</body>
</html>
